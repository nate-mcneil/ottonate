{% macro label_color(stage) %}{% if stage == 'agentStuck' %}Label--danger{% elif stage in ('agentReview', 'agentSpecReview', 'agentBacklogReview', 'agentMergeReady') %}Label--attention{% elif stage in ('agentImplementing', 'agentCIFix', 'agentAddressingReview') %}Label--accent{% elif stage in ('agentPR', 'agentSelfReview') %}Label--done{% else %}Label--secondary{% endif %}{% endmacro %}

{% macro issue_card(item, org) %}
<div class="Box-row {% if item.stage == 'agentStuck' %}color-bg-danger-subtle{% endif %}">
  <div class="d-flex flex-items-center flex-justify-between">
    <div>
      <a href="{{ item.github_url }}" target="_blank" class="Link--primary text-bold">
        {{ org }}/{{ item.repo }}#{{ item.number }}
      </a>
      <span class="Label {{ label_color(item.stage) }} ml-2">{{ item.stage }}</span>
    </div>
  </div>
  <p class="color-fg-muted text-small mb-0 mt-1">{{ item.title }}</p>
</div>
{% endmacro %}

<div class="d-flex flex-wrap" style="gap: 16px;">
  {% set columns = [
    ("Planning", "planning", "color-bg-subtle"),
    ("Implementing", "implementing", "color-bg-subtle"),
    ("Awaiting Human", "awaiting_human", "color-bg-attention-subtle"),
    ("Stuck", "stuck", "color-bg-danger-subtle")
  ] %}

  {% for col_title, col_key, col_bg in columns %}
  <div class="col-12 col-md-3" style="min-width: 280px; flex: 1;">
    <div class="Box">
      <div class="Box-header {{ col_bg }} d-flex flex-items-center flex-justify-between">
        <h3 class="Box-title">{{ col_title }}</h3>
        <span class="Counter">{{ phases[col_key]|length }}</span>
      </div>
      {% if phases[col_key] %}
        {% for item in phases[col_key] %}
          {{ issue_card(item, org) }}
        {% endfor %}
      {% else %}
        <div class="Box-row color-fg-muted text-center text-small">
          No issues
        </div>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>
