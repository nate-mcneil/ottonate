<div class="d-flex flex-wrap mb-4" style="gap: 16px;">
  <div class="Box flex-1" style="min-width: 200px;">
    <div class="Box-header">
      <h3 class="Box-title">Throughput</h3>
    </div>
    <div class="Box-body">
      <div class="d-flex flex-justify-between py-1">
        <span class="color-fg-muted">Total issues</span>
        <span class="text-bold">{{ throughput.total_issues }}</span>
      </div>
      <div class="d-flex flex-justify-between py-1">
        <span class="color-fg-muted">Completed</span>
        <span class="text-bold">{{ throughput.completed_issues }}</span>
      </div>
      <div class="d-flex flex-justify-between py-1">
        <span class="color-fg-muted">In flight</span>
        <span class="text-bold">{{ throughput.total_issues - throughput.completed_issues }}</span>
      </div>
    </div>
  </div>

  <div class="Box flex-1" style="min-width: 200px;">
    <div class="Box-header">
      <h3 class="Box-title">Cost</h3>
    </div>
    <div class="Box-body">
      <div class="d-flex flex-justify-between py-1">
        <span class="color-fg-muted">Total spend</span>
        <span class="text-bold">${{ "%.2f"|format(throughput.total_cost) }}</span>
      </div>
      <div class="d-flex flex-justify-between py-1">
        <span class="color-fg-muted">Avg per issue</span>
        <span class="text-bold">${{ "%.2f"|format(throughput.avg_cost_per_issue) }}</span>
      </div>
    </div>
  </div>
</div>

{% if stage_stats %}
<div class="Box mb-4">
  <div class="Box-header">
    <h3 class="Box-title">Reliability by Stage</h3>
  </div>
  <div class="Box-body p-0">
    <table class="width-full">
      <thead>
        <tr class="color-bg-subtle">
          <th class="p-2 text-left">Stage</th>
          <th class="p-2 text-right">Runs</th>
          <th class="p-2 text-right">Retries</th>
          <th class="p-2 text-right">Stuck</th>
          <th class="p-2 text-right">Total Cost</th>
          <th class="p-2 text-right">Avg Cost</th>
        </tr>
      </thead>
      <tbody>
        {% for stat in stage_stats %}
        <tr>
          <td class="p-2"><span class="Label Label--secondary">{{ stat.stage }}</span></td>
          <td class="p-2 text-right">{{ stat.runs }}</td>
          <td class="p-2 text-right">{{ stat.retries }}</td>
          <td class="p-2 text-right">{% if stat.stuck_count > 0 %}<span class="color-fg-danger">{{ stat.stuck_count }}</span>{% else %}0{% endif %}</td>
          <td class="p-2 text-right">${{ "%.2f"|format(stat.total_cost) }}</td>
          <td class="p-2 text-right">${{ "%.2f"|format(stat.avg_cost) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

{% if completions %}
<div class="Box">
  <div class="Box-header">
    <h3 class="Box-title">Recent Completions</h3>
  </div>
  <div class="Box-body p-0">
    <table class="width-full">
      <thead>
        <tr class="color-bg-subtle">
          <th class="p-2 text-left">Issue</th>
          <th class="p-2 text-right">Cost</th>
          <th class="p-2 text-right">Retries</th>
          <th class="p-2 text-right">Stuck?</th>
          <th class="p-2 text-right">Completed</th>
        </tr>
      </thead>
      <tbody>
        {% for c in completions %}
        <tr>
          <td class="p-2 text-bold">{{ c.issue_ref }}</td>
          <td class="p-2 text-right">${{ "%.2f"|format(c.total_cost) }}</td>
          <td class="p-2 text-right">{{ c.retries }}</td>
          <td class="p-2 text-right">{% if c.was_stuck %}<span class="Label Label--danger">Yes</span>{% else %}No{% endif %}</td>
          <td class="p-2 text-right color-fg-muted">{{ c.completed_at or "N/A" }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div class="blankslate">
  <h3 class="blankslate-heading">No completions yet</h3>
  <p>Completed issues will appear here.</p>
</div>
{% endif %}
